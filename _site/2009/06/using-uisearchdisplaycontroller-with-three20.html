



































































































































<!doctype html>


  <meta charset="utf-8">


<title>Using UISearchDisplayController with Three20 - Edward Benson</title>

<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

<!-- Define a description for better SEO result -->
<meta name="description" content="Joe Hewitt’s Three20 project is a great set of libraries for iPhone development, but one of the inevitable consequences of using it is that Apple eventually releases official versions of some of the same “missing widgets” found in Three20. One...">

<!-- Cheome Web App theme color -->
<meta name="theme-color" content="#ff00b4">

<!-- Feed URL -->
<link rel="alternate" href="/feed.xml" type="application/atom+xml">

<!-- Site icons -->

  
    

    

    
      <link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    
      <link rel="icon" href="/favicon.png" type="image/png">
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    
      <link rel="mask-icon" href="/mask-icon.svg" color="#ff00b4">
    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  


<!-- Chrome Web App manifest -->
<link rel="manifest" href="/manifest.json">

<!-- Main CSS -->
<link rel="stylesheet" href="/assets/themes/curtana/css/app.css?assets-inline">

<!-- Canonical links, avoid duplicate content problems -->
<link rel="canonical" href="http://0.0.0.0:4321/2009/06/using-uisearchdisplaycontroller-with-three20">

<!-- DNS prefetching for static files -->


<!-- browser-sync, don't remove this -->
<!-- BS_INSERT -->

<!-- Head hooks -->


<!-- Open Graph and Twitter Cards support, more info: https://dev.twitter.com/docs/cards -->
<meta property="og:type" content="article">
<meta property="og:site_name" content="Edward Benson">
<meta property="og:title" content="Using UISearchDisplayController with Three20">
<meta property="og:url" content="http://0.0.0.0:4321/2009/06/using-uisearchdisplaycontroller-with-three20">
<meta property="og:description" content="Joe Hewitt’s Three20 project is a great set of libraries for iPhone development, but one of the inevitable consequences of using it is that Apple eventually releases official versions of some of the same “missing widgets” found in Three20. One...">
<meta property="og:image" content="//sparanoid.s3-website-us-east-1.amazonaws.com/searchcontroller.png">

<meta name="twitter:card" content="summary_large_image">


  <meta name="twitter:site" content="@sparanoid">



  <meta name="twitter:creator" content="@edwardbenson">



  <meta property="article:published_time" content="2009-06-29T00:00:00-07:00">
  <meta property="article:modified_time" content="">
  <meta name="twitter:label1" value="Words">
  <meta name="twitter:data1" value="761 words">
  <meta name="twitter:label2" value="Reading time">
  <meta name="twitter:data2" value="3 mins">


<!-- Post specified styles -->
<style data-assets-inline>
  /*
    TODO: You have to speicify background color for `html` in order to make `-webkit-filter` work
    Link: https://bugs.chromium.org/p/chromium/issues/detail?id=591015
    Date: Mar 1, 2016, 5:41 PM
  */
  html {
    
  }

  body {
    

    

    
  }

  

  

  

  
  
    

  

  

  /*
    TODO: Need a better solution. I have to redefine the whole box-shadow here because no invidual box-shadow-color exists
    Date: Mar 12, 2016, 12:09 AM
  */
  

  

  

  
</style>

<!-- Main navigation with current page / categoriy highlighted -->
<nav class="navigation">
  <ul>
    
      








      
      
      <li >
        <a href="/">
          
            Writing
          
        </a>
      </li>
    
      








      
      
      <li >
        <a href="/research/">
          
            Research
          
        </a>
      </li>
    
      








      
      
      <li >
        <a href="/about/">
          
            About
          
        </a>
      </li>
    
  </ul>
</nav>

<!-- Main content wrap -->
<main class="content " role=main>
  



































































































































<!-- Post-wide custom CSS -->

  


<!-- Article wrapper, limit width -->
<article 
  
>

  <!-- Post title -->
  <header 
  style="     "
>

    <h1 class="
  
" title="Using UISearchDisplayController with Three20" data-title="Using UISearchDisplayController with Three20">
      
  
    
  
    Using UISearchDisplayController with Three20<span class="dot dot--post"> </span>
  

  

    </h1>

    
      <small>
        By <span rel="author">Ted Benson</span>
        on <time datetime="2009-06-29T00:00:00-07:00">Jun 29, 2009</time>
      </small>
    

    

  </header>

  <!-- Post content -->
  <div class="post-content">
    <p>Joe Hewitt’s <a href="http://github.com/joehewitt/three20/tree/master/">Three20
project</a> is a great set of libraries for iPhone development, but one of the
inevitable consequences of using it is that Apple eventually releases official
versions of some of the same “missing widgets” found in Three20. One such
example is the search functionality in tables.</p>

<p>I have been using Three20 for an exciting project I’m working on over the
summer, but also wanted to leverage the new search functionality of the iPhone
OS 3.0 instead of the Three20 search feature. It took about a day of poking
around the code-base of both, but ultimately only a few changes to the code,
which I’ll describe here.</p>

<h2 id="step-1-implement-the-search-delegates-in-your-tttableviewcontroller">Step 1: Implement the search delegates in your TTTableViewController</h2>

<p>In your TTTableViewController interface, tack on the
<code class="highlighter-rouge">UISearchDisplayDelegate</code> and <code class="highlighter-rouge">UISearchBarDelegate</code> interfaces to
say you’ll be implementing those. They will let the search bar and controller
send your controller events to let it know it is taking over.</p>

<h2 id="step-2-add-the-search-bar-to-your-table-header">Step 2: Add the search bar to your table header</h2>

<p>In your <code class="highlighter-rouge">loadView</code> method, create a new <code class="highlighter-rouge">UISearchBar</code> object and
add it to your table’s header, like so:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// [SNIP]
UISearchBar *searchBar = [[UISearchBar alloc] initWithFrame:CGRectMake(0, 0, self.tableView.frame.size.width, 0)];
searchBar.delegate = self;
searchBar.showsCancelButton = YES;
[searchBar sizeToFit];
self.tableView.tableHeaderView = searchBar;
[searchBar release];
</code></pre></div></div>

<h2 id="step-3-add-a-searchdisplaycontroller-to-your-controller">Step 3: Add a SearchDisplayController to your controller</h2>

<p>In the same <code class="highlighter-rouge">loadView</code> method, create a new
<code class="highlighter-rouge">UISearchDisplayController</code>and add it to self:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// [SNIP]
UISearchDisplayController *searchDisplayController = [[UISearchDisplayController alloc] initWithSearchBar:searchBar contentsController:self];
[self setSearchDisplayController:searchDisplayController];        
[searchDisplayController setDelegate:self];
[searchDisplayController setSearchContentsController:self];
[searchDisplayController setSearchResultsDataSource:self.dataSource];        
[searchDisplayController release];
</code></pre></div></div>

<p>Notice above that you are pointing the SearchDisplayController at several
different items: the UISearchBar from before, <code class="highlighter-rouge">self</code>, and also your
<code class="highlighter-rouge">TTTableViewDataSource</code>.</p>

<h2 id="step-4-implement-the-required-delegates">Step 4. Implement the required delegates</h2>

<p>Next we’ll implement the required delegate methods that will be called when the
user interacts with the search bar.  Notice below that we’re using these
methods to essentially pass information through to the data source.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>- (void)filterContentForSearchText:(NSString*)searchText scope:(NSString*)scope {
  [self.dataSource filterContentForSearchText:searchText scope:scope];
} 

- (BOOL)searchDisplayController:(UISearchDisplayController *)controller shouldReloadTableForSearchString:(NSString *)searchString {
  [self filterContentForSearchText:searchString scope:
    [[self.searchDisplayController.searchBar scopeButtonTitles] objectAtIndex:[self.searchDisplayController.searchBar selectedScopeButtonIndex]]];
    // Return YES to cause the search result table view to be reloaded.
    return YES;
}

- (BOOL)searchDisplayController:(UISearchDisplayController *)controller shouldReloadTableForSearchScope:(NSInteger)searchOption {
  [self filterContentForSearchText:[self.searchDisplayController.searchBar text] scope:
  [[self.searchDisplayController.searchBar scopeButtonTitles] objectAtIndex:searchOption]];
  // Return YES to cause the search result table view to be reloaded.
  return YES;
}

- (void)searchDisplayControllerDidBeginSearch:(UISearchDisplayController *)controller {
  DKSearchableDataSource *ds = self.dataSource;
  [controller setSearchResultsDelegate:self.tableView.delegate];
  ds.searchActive = YES;
}

- (void)searchDisplayControllerDidEndSearch:(UISearchDisplayController *)controller {
  DKSearchableDataSource *ds = self.dataSource;
  ds.searchActive = NO;
}
</code></pre></div></div>

<p><strong>Important!</strong> Notice the <code class="highlighter-rouge">setSearchResultsDelegate</code> call above.
This occurs here instead of the <code class="highlighter-rouge">loadView</code> method above because the
table delegate hasn’t yet been created when we’re still inside of
<code class="highlighter-rouge">loadView</code> – if you were to set it up there then selecting search
result cells wouldn’t trigger a callback.</p>

<h2 id="step-5-modify-your-data-source-to-be-aware-of-search">Step 5. Modify your data source to be aware of search</h2>

<p>Finally, we need to modify our data source to be aware of this new “search
mode.” I did this with a pretty simple fix: I created a boolean property named
<code class="highlighter-rouge">searchActive</code> that is set by the owning controller (see the above code). Then,
in all the important methods, I put in a simple <code class="highlighter-rouge">if..else</code> statement that
returned one value for search mode results and another value for normal usage.
Here’s an example:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>- (NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section {
  if (self.searchActive &amp;amp;&amp;amp; (self.searchText != nil)) {
    return self.filteredItems.count;
  }  else {
    return self.items.count;
  }
}
</code></pre></div></div>

<p>In the above conditional, I check for <code class="highlighter-rouge">searchText</code> to see if the user
has begun searching yet. If they haven’t I want to display all results.</p>

<p>Finally, I need to implement the actual search method, which is simply passed
through from the controller class.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>- (void)filterContentForSearchText:(NSString*)searchText scope:(NSString*)scope {
  [self.filteredItems removeAllObjects]; // First clear the filtered array.
  self.searchText = searchText;
        
  /*
   * Search the main list for products whose type matches the scope (if
   * selected) and whose name matches searchText; add items that match to the
   * filtered array.
   */
   for (id *item in _items) {
     NSComparisonResult result = [[item searchText] compare:searchText options:(NSCaseInsensitiveSearch|NSDiacriticInsensitiveSearch) range:NSMakeRange(0, [searchText length])];
     if (result == NSOrderedSame) {
       [self.filteredItems addObject:item];
     }
   }
}
</code></pre></div></div>

<h2 id="conclusion">Conclusion</h2>

<p>I left a lot of explanation out here, but I hope this is enough to get you
started on using Apple’s “official” search functionality with the Three20
library. Leave a comment if you have any questions or need a bit more
explanation of the code and I’ll be glad to amend the post.</p>



    
    

    
  </div>

</article>


</main>

<!-- Footer section -->

  <footer class="footer">
    <ul>
      <li><a href="/">Edward Benson</a></li>
      <li><a href="http://www.twitter.com/edwardbenson" title="@edwardbenson">@edwardbenson</a></li>

      

      <li><a href="/feed.xml" title="Feed - Atom (The Atom Syndication Format)">Atom</a></li>
    </ul>
  </footer>


<!-- Theme scripts -->
<script src="/assets/themes/curtana/js/app.js?assets-inline"></script>

<!-- User scripts -->
<script src="/assets/js/user.js?assets-inline"></script>

<!-- Lightense Images -->


<!-- Service Worker  -->

  


<!-- Google Analytics -->

  


<!-- Foot hooks -->



