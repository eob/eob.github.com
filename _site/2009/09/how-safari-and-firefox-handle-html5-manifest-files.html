



































































































































<!doctype html>


  <meta charset="utf-8">


<title>How Safari and Firefox handle HTML 5 Manifest files - Edward Benson</title>

<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

<!-- Define a description for better SEO result -->
<meta name="description" content="I was doing some experiments with Adam in the lab on Friday, and we discovered some interesting variations in the way that Firefox and Safari implement the HTML 5 Cache Manifest specification. I think this is a particularly important feature...">

<!-- Cheome Web App theme color -->
<meta name="theme-color" content="#ff00b4">

<!-- Feed URL -->
<link rel="alternate" href="/feed.xml" type="application/atom+xml">

<!-- Site icons -->

  
    

    

    
      <link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    
      <link rel="icon" href="/favicon.png" type="image/png">
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    
      <link rel="mask-icon" href="/mask-icon.svg" color="#ff00b4">
    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  


<!-- Chrome Web App manifest -->
<link rel="manifest" href="/manifest.json">

<!-- Main CSS -->
<link rel="stylesheet" href="/assets/themes/curtana/css/app.css?assets-inline">

<!-- Canonical links, avoid duplicate content problems -->
<link rel="canonical" href="http://0.0.0.0:4321/2009/09/how-safari-and-firefox-handle-html5-manifest-files">

<!-- DNS prefetching for static files -->


<!-- browser-sync, don't remove this -->
<!-- BS_INSERT -->

<!-- Head hooks -->


<!-- Open Graph and Twitter Cards support, more info: https://dev.twitter.com/docs/cards -->
<meta property="og:type" content="article">
<meta property="og:site_name" content="Edward Benson">
<meta property="og:title" content="How Safari and Firefox handle HTML 5 Manifest files">
<meta property="og:url" content="http://0.0.0.0:4321/2009/09/how-safari-and-firefox-handle-html5-manifest-files">
<meta property="og:description" content="I was doing some experiments with Adam in the lab on Friday, and we discovered some interesting variations in the way that Firefox and Safari implement the HTML 5 Cache Manifest specification. I think this is a particularly important feature...">
<meta property="og:image" content="http://www.edwardbenson.com/images/posts/manifest-firefox1.png">

<meta name="twitter:card" content="summary_large_image">


  <meta name="twitter:site" content="@sparanoid">



  <meta name="twitter:creator" content="@edwardbenson">



  <meta property="article:published_time" content="2009-09-26T00:00:00-07:00">
  <meta property="article:modified_time" content="">
  <meta name="twitter:label1" value="Words">
  <meta name="twitter:data1" value="819 words">
  <meta name="twitter:label2" value="Reading time">
  <meta name="twitter:data2" value="4 mins">


<!-- Post specified styles -->
<style data-assets-inline>
  /*
    TODO: You have to speicify background color for `html` in order to make `-webkit-filter` work
    Link: https://bugs.chromium.org/p/chromium/issues/detail?id=591015
    Date: Mar 1, 2016, 5:41 PM
  */
  html {
    
  }

  body {
    

    

    
  }

  

  

  

  
  
    

  

  

  /*
    TODO: Need a better solution. I have to redefine the whole box-shadow here because no invidual box-shadow-color exists
    Date: Mar 12, 2016, 12:09 AM
  */
  

  

  

  
</style>

<!-- Main navigation with current page / categoriy highlighted -->
<nav class="navigation">
  <ul>
    
      








      
      
      <li >
        <a href="/">
          
            Writing
          
        </a>
      </li>
    
      








      
      
      <li >
        <a href="/research/">
          
            Research
          
        </a>
      </li>
    
      








      
      
      <li >
        <a href="/about/">
          
            About
          
        </a>
      </li>
    
  </ul>
</nav>

<!-- Main content wrap -->
<main class="content " role=main>
  



































































































































<!-- Post-wide custom CSS -->

  


<!-- Article wrapper, limit width -->
<article 
  
>

  <!-- Post title -->
  <header 
  style="     "
>

    <h1 class="
  
" title="How Safari and Firefox handle HTML 5 Manifest files" data-title="How Safari and Firefox handle HTML 5 Manifest files">
      
  
    
  
    How Safari and Firefox handle HTML 5 Manifest files<span class="dot dot--post"> </span>
  

  

    </h1>

    
      <small>
        By <span rel="author">Ted Benson</span>
        on <time datetime="2009-09-26T00:00:00-07:00">Sep 26, 2009</time>
      </small>
    

    

  </header>

  <!-- Post content -->
  <div class="post-content">
    <p>I was doing some experiments with Adam in the lab on Friday, and we discovered
some interesting variations in the way that Firefox and Safari implement the
HTML 5 Cache Manifest specification. I think this is a particularly important
feature to have implemented consistently across platforms because it is the
make-or-break feature of HTML5 that will permit web applications to function
offline.</p>

<h2 id="first-what-is-the-manifest">First, what is the manifest?</h2>

<p>For people who haven’t heard about this feature before, the manifest is
essentially a special file that lists portions of a web site that should be
cached locally for offline access. This is the feature of HTML 5 that will
standardize the type of “airplane mode” access that GMail users have with
Google’s custom Gears plugin. The manifest is served as a regular old file,
with MIME type <code class="highlighter-rouge">text/cache-manifest</code>, and is linked from the <code class="highlighter-rouge">html</code> tag itself,
as follows:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;html</span> <span class="na">manifest=</span><span class="s">"site.manifest"</span><span class="nt">&gt;</span>

 ..

<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<p>Once a web site is marked as being cached, then the browser will use the local
cached copy of all the files specified in the manifest instead of attempting to
load them from the internet. Say you’re on an airplane and type in the URL for
<code class="highlighter-rouge">http://my_cached_site.com</code>. The browser will recognize it as a cached one,
load it from its local storage instead, and then use a new JavaScript API to
inform the web site that it is running in offline mode. So now for the
important part, how do these two browsers (Firefox and Safari) handle this
file?</p>

<h2 id="firefox">Firefox</h2>

<p>Upon loading an HTML5 document with a manifest attached, Firefox firsts asks
permission to cache the site offline before requesting the manifest file from
the server. Here is how the toolbar looks on my browser:</p>

<p><img src="http://www.edwardbenson.com/images/posts/manifest-firefox1.png" alt="Firefox 1" /></p>

<p>And here is the server log (I’m using a Rails project to test this) to show
that the manifest was not yet loaded:</p>

<p><img src="http://www.edwardbenson.com/images/posts/manifest-log1.png" alt="Log 1" /></p>

<p>If you choose to allow offline caching, the web browser then requests the cache
file, as can be seen from this screen shot.</p>

<p><img src="http://www.edwardbenson.com/images/posts/manifest-log2.png" alt="Log 2" /></p>

<p>Now here’s the cool thing, I set the headers on the manifest file such that the
manifest file itself should also be cached on the client side:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> headers["Expires"] = "Fri, 30 Oct 2010 14:19:41 GMT"
 headers["Cache-Control"] = "max-age=3600, must-revalidate"
</code></pre></div></div>

<p>And the result of this is that the subsequent load, no files at all are loaded
from Firefox – it operates entirely offline. Notice the completely empty
server log as I reload the site 2..n times.</p>

<p><img src="http://www.edwardbenson.com/images/posts/manifest-log3.png" alt="Log 3" /></p>

<h2 id="safari">Safari</h2>

<p>Now let’s look at how Safari does it. Upon loading the web page, Safari also
does not load the manifest file, as can be seen from this screen shot:</p>

<p><img src="http://www.edwardbenson.com/images/posts/manifest-log4.png" alt="Log 4" /></p>

<p>However, it also does not ask any questions about offline access. The next time
I load the web page, something strange happens. Safari checks the manifest file
twice and then doesn’t load the actual HTML page (because it doesn’t have to).
The double-loading of the manifest file appears to be on the second page load,
not split 1/1 between the page departure and subsequent reload. A little
strange, if you ask me.</p>

<p><img src="http://www.edwardbenson.com/images/posts/manifest-log5.png" alt="Log 5" /></p>

<p>Furthermore, when I reload the page, despite the HTTP headers specifying that
the manifest should be cached, Safari reloads the manifest file. Though, at
least it only loads it once for every subsequent time:</p>

<p><img src="http://www.edwardbenson.com/images/posts/manifest-log6.png" alt="Log 6" /></p>

<h2 id="conclusion">Conclusion</h2>

<p>I’m no spec-master, but it seems like Firefox’s implementation of this feature
is what I would want to happen as a web architect, while Safari’s behavior
seems a bit strange.</p>

<p>Firefox:</p>

<ol>
  <li>Only loads the web page once</li>
  <li>Asks the user for permission to enter offline mode</li>
  <li>Only downloads the manifest file once if given permission</li>
  <li>Then obeys HTTP Cache Control headers to suppress reloading the manifest file on future loads</li>
</ol>

<p>If Safari were to also behave like this, there are a few fixes that need to be
implemented. Namely:</p>

<ol>
  <li>Ask the user if offline access should be allowed</li>
  <li>Load the manifest when the user loads the page the first time (and approves offline mode), not the second time, when the user might be on an airplane</li>
  <li>Stop loading the manifest file multiple times in a single page load</li>
  <li>Start obeying the HTTP cache headers so that zero web connections are necessary if the cache says so</li>
</ol>

<p>Safari’s Manifest handling quirks aside, both browser teams should be applauded
for so aggressively implementing the HTML5 spec. It is a real treat as someone
  researching web platforms to get to test the in-progress spec on real
  browsers instead of just talking about what might eventually happen down the
  road.</p>

<p>This article is
<a href="http://groups.csail.mit.edu/haystack/blog/2009/09/26/how-safari-and-firefox-handle-html-5-manifest-files/">cross-posted</a>
on the <a href="http://groups.csail.mit.edu/haystack/blog/">Haystack Blog</a>.</p>


    
    

    
  </div>

</article>


</main>

<!-- Footer section -->

  <footer class="footer">
    <ul>
      <li><a href="/">Edward Benson</a></li>
      <li><a href="http://www.twitter.com/edwardbenson" title="@edwardbenson">@edwardbenson</a></li>

      

      <li><a href="/feed.xml" title="Feed - Atom (The Atom Syndication Format)">Atom</a></li>
    </ul>
  </footer>


<!-- Theme scripts -->
<script src="/assets/themes/curtana/js/app.js?assets-inline"></script>

<!-- User scripts -->
<script src="/assets/js/user.js?assets-inline"></script>

<!-- Lightense Images -->


<!-- Service Worker  -->

  


<!-- Google Analytics -->

  


<!-- Foot hooks -->



