



































































































































<!doctype html>


  <meta charset="utf-8">


<title>How to approach structured data extraction from images - Edward Benson</title>

<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

<!-- Define a description for better SEO result -->
<meta name="description" content="I’ve been doing a lot of image processing lately, with the goal of extracting the structured data visible inside an image. While I’ve still got beginner-brain and a mountain of OpenCV tutorials fresh in my mind, I thought I’d write...">

<!-- Cheome Web App theme color -->
<meta name="theme-color" content="#ff00b4">

<!-- Feed URL -->
<link rel="alternate" href="/feed.xml" type="application/atom+xml">

<!-- Site icons -->

  
    

    

    
      <link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    
      <link rel="icon" href="/favicon.png" type="image/png">
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    
      <link rel="mask-icon" href="/mask-icon.svg" color="#ff00b4">
    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  
    

    

    
  


<!-- Chrome Web App manifest -->
<link rel="manifest" href="/manifest.json">

<!-- Main CSS -->
<link rel="stylesheet" href="/assets/themes/curtana/css/app.css?assets-inline">

<!-- Canonical links, avoid duplicate content problems -->
<link rel="canonical" href="http://0.0.0.0:4321/2018/01/structured-extraction-from-images">

<!-- DNS prefetching for static files -->


<!-- browser-sync, don't remove this -->
<!-- BS_INSERT -->

<!-- Head hooks -->


<!-- Open Graph and Twitter Cards support, more info: https://dev.twitter.com/docs/cards -->
<meta property="og:type" content="article">
<meta property="og:site_name" content="Edward Benson">
<meta property="og:title" content="How to approach structured data extraction from images">
<meta property="og:url" content="http://0.0.0.0:4321/2018/01/structured-extraction-from-images">
<meta property="og:description" content="I’ve been doing a lot of image processing lately, with the goal of extracting the structured data visible inside an image. While I’ve still got beginner-brain and a mountain of OpenCV tutorials fresh in my mind, I thought I’d write...">
<meta property="og:image" content="https://cdn-images-1.medium.com/max/1600/1*mGCQgGrgwkpUQAgYReq9_A.png">

<meta name="twitter:card" content="summary_large_image">


  <meta name="twitter:site" content="@sparanoid">



  <meta name="twitter:creator" content="@edwardbenson">



  <meta property="article:published_time" content="2018-01-17T00:00:00-08:00">
  <meta property="article:modified_time" content="">
  <meta name="twitter:label1" value="Words">
  <meta name="twitter:data1" value="994 words">
  <meta name="twitter:label2" value="Reading time">
  <meta name="twitter:data2" value="4 mins">


<!-- Post specified styles -->
<style data-assets-inline>
  /*
    TODO: You have to speicify background color for `html` in order to make `-webkit-filter` work
    Link: https://bugs.chromium.org/p/chromium/issues/detail?id=591015
    Date: Mar 1, 2016, 5:41 PM
  */
  html {
    
  }

  body {
    

    

    
  }

  

  

  

  
  
    

  

  

  /*
    TODO: Need a better solution. I have to redefine the whole box-shadow here because no invidual box-shadow-color exists
    Date: Mar 12, 2016, 12:09 AM
  */
  

  

  

  
</style>

<!-- Main navigation with current page / categoriy highlighted -->
<nav class="navigation">
  <ul>
    
      








      
      
      <li >
        <a href="/">
          
            Writing
          
        </a>
      </li>
    
      








      
      
      <li >
        <a href="/research/">
          
            Research
          
        </a>
      </li>
    
      








      
      
      <li >
        <a href="/about/">
          
            About
          
        </a>
      </li>
    
  </ul>
</nav>

<!-- Main content wrap -->
<main class="content " role=main>
  



































































































































<!-- Post-wide custom CSS -->

  


<!-- Article wrapper, limit width -->
<article 
  
>

  <!-- Post title -->
  <header 
  style="     "
>

    <h1 class="
  
" title="How to approach structured data extraction from images" data-title="How to approach structured data extraction from images">
      
  
    
  
    How to approach structured data extraction from images<span class="dot dot--post"> </span>
  

  

    </h1>

    
      <small>
        By <span rel="author">Ted Benson</span>
        on <time datetime="2018-01-17T00:00:00-08:00">Jan 17, 2018</time>
      </small>
    

    

  </header>

  <!-- Post content -->
  <div class="post-content">
    <p>I’ve been doing a lot of image processing lately, with the goal of extracting
the structured data visible inside an image. While I’ve still got beginner-brain
and a mountain of OpenCV tutorials fresh in my mind, I thought I’d write a bit
about <em>how to successfully approach image extraction problems.</em></p>

<p>Here’s one scenario I’m working with: many online services ask users to prove
their identity with photos of ID cards, paystubs, bank statements, and the like.
Rather than running a standard OCR on these images, it would be nice to
<em>directly</em> recover the structured data they represent.</p>

<p><img src="https://cdn-images-1.medium.com/max/1600/1*mGCQgGrgwkpUQAgYReq9_A.png" alt="" /></p>

<p>This post records the first two “ah hah!” moment’s I had while diving into that
problem. Both are about how to organize your thinking, rather than any specific
OpenCV trick:</p>

<ol>
  <li>How to decompose an image extraction problem into smaller problems</li>
  <li>How to decompose an image extraction problem into “side” problems</li>
</ol>

<h3 id="how-to-decompose-an-image-extraction-problem-into-smaller-problems">How to decompose an image extraction problem into smaller problems</h3>

<p>When I first started, this kind of task felt insurmountably large because I had
no idea how to make incremental progress. Here’s the recipe I’ve found for
breaking down a large image task into smaller pieces:</p>

<p>Force yourself to write down the sentence</p>

<blockquote>
  <p>“I’ve got X… but if only I had Y, I could easily produce Z”</p>
</blockquote>

<p>The transformation <strong>Y</strong>→<strong>Z</strong> should be something so simple that you already
see clearly how to do it. In fact, your next step should be to implement and
test it right away. Having solved the easy problem <strong>Y</strong>→<strong>Z</strong>, you’ve now
simplified the hard problem into only <strong>X→Y</strong>.</p>

<p>Here are my initial <strong>X</strong>, <strong>Y</strong>, and **Z **for the social security card
example:</p>

<ul>
  <li>**I’ve got **a random photo containing an SSN card…</li>
  <li><em>*but if only I had **a *rectified</em>, <em>registered [</em>] *social security card
image…</li>
  <li><strong>I could easily</strong> use the fixed geometry of the card to simply crop and OCR
exactly the the <strong>SSN</strong> and <strong>Name</strong> fields.</li>
</ul>

<p><em>[</em>] Note: <em><a href="https://en.wikipedia.org/wiki/Image_rectification">Rectified</a></em>
means ‘projected onto a reference plane’ and [2]
<em><a href="https://en.wikipedia.org/wiki/Image_registration">registered</a></em> means ‘aligned
to a known coordinate system.’*</p>

<p>Having solved <strong>Y→Z</strong>, now I’m left with only the problem “how do I take my
input image <strong>X **and produce a rectified, registered image **Y</strong>?”</p>

<ul>
  <li>If I know how to solve that directly, great!</li>
  <li>If I don’t, I can just repeat this decomposition over again, dividing the
problem <strong>X→Y **into some new problem **X→X2→Y</strong>.</li>
</ul>

<p>Read on for a variant of this decomposition that will help us do exactly that
second part.</p>

<h3 id="how-to-decompose-an-image-extraction-problem-into-side-problems">How to decompose an image extraction problem into “side” problems</h3>

<p>This is a point that feels obvious in retrospect, but it took me a while to
realize it:</p>

<blockquote>
  <p>Sometimes Y is just extra information. It’s not an intermediate version of your
image.</p>
</blockquote>

<p>When I first started, I had this idea that image processing was like 35mm film
processing: you take a photo and apply various baths and chemicals, refining it
until you see the picture you want. Except in our case, the baths and chemicals
are kernels and matrix operations.</p>

<p>This mental model is all wrong.</p>

<p>The successful model is to remember that you can go on *side adventures with
copies of the image. *These side adventures might destroy the data in the image,
but they will produce valuable data that you can then use when returning to your
original image.</p>

<p>In other words:</p>

<ul>
  <li><strong>Clone(X)→Y</strong>Go on a side adventure with a clone of X to compute statistics Y</li>
  <li>(<strong>X, Y)→Z</strong><br /> Use the combination of <strong>X **and **Y</strong> to compute <strong>Z</strong></li>
</ul>

<p>Let’s see how that looks in our social security cards. Remember, our job is to
isolate, rectify, and register the social security card.</p>

<p>Here’s one simple approach: we might grey the image, blur it, edge-detect it,
contour detect it, and then retain only the contour that represents the largest
4-gon.</p>

<p><span class="figcaption_hack">Sketch of the side mission to find some data <strong>Y</strong> that will be useful in taking
<strong>X→Z</strong>.</span></p>

<p>We now throw away all the data on that side adventure and just keep the
coordinates of the 4-gon, which we’ll call <strong>Y</strong>.</p>

<p>Returning back to the original image, we can use that polygon to extract the
region of the image that we think is our card, and then apply an off-the-shelf
transform to rectify it. <strong>(X, Y)→Z</strong>.</p>

<p><span class="figcaption_hack">If we have the (correct) coordinates of the 4-gon that represents the card, we
can easily extract that region of the image and rectify it to produce the shape.</span></p>

<h3 id="rinse-repeat-youre-done">Rinse, repeat, you’re done!</h3>

<p>I’ve obviously skipped some steps above: I’m not registering the rectified
social security card against a known template, so the coordinates may be a bit
off (in real life, the rectified card won’t be as perfectly isolated as the
diagram above).</p>

<p>But that’s OK, because to add any extra steps, you can just keep applying the
two problem decomposition patterns above.</p>

<p>And when you’re ready to ship code, these patterns provide natural groupings
that you can use to divide code into modules that will make sense to a future
reader. I don’t know about you, but long, linear OpenCV functions look like
gibberish to me. Much easier if you can help someone visualize what you were
thinking when you did what you did:</p>

<h3 id="toward-extraction-with-deep-nets">Toward extraction with deep nets</h3>

<p>This whole writeup is based on experiences with what you might call “old school”
image processing, in which the human comes up with an entirely heuristic model
to achieve their objective.</p>

<p>I’m curious to find out how it holds up as a way to approach image extraction
problems using deep learning, which tends to favor a more data-heavy /
heuristics-light approach.</p>

<p>If you have opinions.. let me know!</p>

<h4 id="note-were-hiring">Note: we’re hiring!</h4>

<p>If you like solving puzzles like this and want to make a big impact in industry,
<a href="mailto:jobs@instabase.com">reach out and say hello</a>. We’re building an amazing
team at Instabase and looking to grow.</p>


    
    

    
  </div>

</article>


</main>

<!-- Footer section -->

  <footer class="footer">
    <ul>
      <li><a href="/">Edward Benson</a></li>
      <li><a href="http://www.twitter.com/edwardbenson" title="@edwardbenson">@edwardbenson</a></li>

      

      <li><a href="/feed.xml" title="Feed - Atom (The Atom Syndication Format)">Atom</a></li>
    </ul>
  </footer>


<!-- Theme scripts -->
<script src="/assets/themes/curtana/js/app.js?assets-inline"></script>

<!-- User scripts -->
<script src="/assets/js/user.js?assets-inline"></script>

<!-- Lightense Images -->


<!-- Service Worker  -->

  


<!-- Google Analytics -->

  


<!-- Foot hooks -->



