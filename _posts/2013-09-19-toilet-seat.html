---
layout: post
title: A probabilistic analysis of leaving the toilet seat down
permalink: /2013/09/probabilistic-toilet-seat-analysis/
published: false
jqui: true
latex: true
d3: true
---

<h2>Variables</h2>

<p>I will assign a constant penalty for touching the toilet seat during your
bathroom session.</p>

<table>
  <tr>
    <td>\( Penalty \)</td>
    <td>The penalty for touching the toilet seat.</td>
  </tr>
  <tr>
    <td>\( P_{Him} \)</td>
    <td>The probability that on any random bathroom visit, it is the male in
      the bathroom. For example, \( P_{Him} = 0.5 \) would be the case in which the man and
      woman go to the bathroom with equal frequency, and \( P_{Him} = 1.0 \) is the case where the woman never goes to the bathroom.</td>
  </tr>
  <tr>
    <td>\( P_{Pee} \)</td>
    <td>The probability that, when the <b>man</b> goes to the bathroom, he pees. If \( P_{Pee} = 0.75 \), for example, it means the man pees three times for every time he poops.</td>
  </tr>
</table>     

<p>That's it. It turns out that the woman's bathroom habits cancel out in the
math so these are the only two variables we need.</p>

<h2>Policy 1: Everyone leaves the toilet seat down</h2>

<p>This case is easy. Both parties can assume the seat will be down when they
arrive, so the man only needs be concerned with lifting the seat to pee. He
incurs the penalty twice: once for putting the seat up, and once for putting it
back down.</p>

<table>
 <tr>
   <td>\(Cost_{Her, 1}\)</td>
   <td>\(= 0\)</td>
 </tr>
 <tr>
   <td>\(Cost_{Him, 1}\)</td>
   <td>\(= 2 * P_{Pee} * Penalty \)</td>
 </tr>
</table>

<p>You might argue that the man should only incur the penalty once: after all,
he is washing his hands afterwar, so what's wrong with a second toilet seat
manipulation if you've already done a first.  We'll call this special case
Policy 1-Prime:

<table>
 <tr>
   <td>\(Cost_{Him, 1}' \)</td>
   <td>\(= P_{Pee} * Penalty \)</td>
 </tr>
</table>


<h2>Policy 2: Everyone leaves the toilet seat as is</h2>

<table>
 <tr>
   <td colspan="2">
   <p>Since the woman always leaves the toilet seat down, she only needs to
   touch the seat when the man went before her and he peed.</p>
   </td>
 <tr>
   <td>\(Cost_{Her, 2} =\)</td>
   <td>\( P_{Him} * P_{Pee} * Penalty  \)</td>
 </tr>
 <tr>
   <td colspan="2">

     <p>The man's case is more complicated.</p>
     
     <p>If he is peeing, he touches the seat if the woman went before him, or
     if he went last time and pooped. If he is pooping, he touches the seat if
     he went last time and peed.</p>
     
   </td>
 </tr>
 <tr>
   <td>\(Cost_{Him, 2} =\)</td>
   <td>
    <table>
      <tr>
        <td>\( Penalty  \biggr ( \)</td>
        <td>

     <table>
      <tr>
        <td></td>
        <td>\( P_{Pee} \)</td>
        <td>\( \big ( P_{Him} (1 - P_{Pee}) + (1 - P_{Him}) \big ) \)</td>
     </tr>
      <tr>
        <td>\( +\)</td>
        <td>\( (1 - P_{Pee}) \)</td>
        <td>\( \big ( P_{Him} P_{Pee} \big ) \)</td>
      </tr>

    </table>
        
        </td>
        <td>\( \biggr ) \)</td>
      </tr>
    </table>
  </td>
 </tr></table>

<script>
var MAN = 0;
var WOMAN = 1;
var PEE = 0;
var POOP = 1;

var cw1 = function() {
  return 0;
};

var cm1 = function(whoGoes, action, penalty) {
  return action[MAN][PEE] * penalty;
};

var cm1p = function(whoGoes, action, penalty) {
  return 2 * action[MAN][PEE] * penalty;
};

var cw2 = function(whoGoes, action, penalty) {
  return whoGoes[MAN] * action[MAN][PEE] * penalty;
};

var cm2 = function(whoGoes, action, penalty) {
  return (
    (penalty * action[MAN][POOP] * (whoGoes[MAN] * action[MAN][PEE])) +
    (penalty * action[MAN][PEE] * (whoGoes[MAN] * action[MAN][POOP] + whoGoes[WOMAN]))
  );
};

var getData = function() {
  var phim = parseFloat($("#whoGoesMore").slider("value"));
  var whoGoes = [phim, 1-phim];
  var phimpee = parseFloat($("#whatHeDoes").slider("value"));
  var action = [
    [1-phimpee, phimpee]
  ];
  var penalty = 1;
  var CM1 = cm1(whoGoes, action, penalty);
  var CM1P = cm1p(whoGoes, action, penalty);
  var CM2 = cm2(whoGoes, action, penalty);
  var CW1 = cw1(whoGoes, action, penalty);
  var CW2 = cw2(whoGoes, action, penalty);
  return [
    {"Policy": "Policy 1",
     "Man": CM1,
     "Woman": CW1},
    {"Policy": "Policy 1-Prime",
     "Man": CM1P,
     "Woman": CW1},
    {"Policy": "Policy 2",
     "Man": CM2,
     "Woman": CW2}
  ];
};

var calculate = function() {
  var phim = parseFloat($("#whoGoesMore").slider("value"));
  var whoGoes = [phim, 1-phim];
  var phimpee = parseFloat($("#whatHeDoes").slider("value"));
  var action = [
    [1-phimpee, phimpee]
  ];
  var penalty = 1;
  var CM1 = cm1(whoGoes, action, penalty);
  var CM1P = cm1p(whoGoes, action, penalty);
  var CM2 = cm2(whoGoes, action, penalty);
  var CW1 = cw1(whoGoes, action, penalty);
  var CW2 = cw2(whoGoes, action, penalty);

  $("#cm1").html(CM1.toFixed(2));
  $("#cw1").html(CW1.toFixed(2));
  $("#cm1p").html(CM1P.toFixed(2));
  $("#cw1p").html(CW1.toFixed(2));
  $("#cm2").html(CM2.toFixed(2));
  $("#cw2").html(CW2.toFixed(2));
  $("#cj1").html((CM1 + CW1).toFixed(2));
  $("#cj1p").html((CM1P + CW1).toFixed(2));
  $("#cj2").html((CM2 + CW2).toFixed(2));
}

</script>

<h2>Simulation</h2>

<p>I've left the solution so generalized because I can't presume how much you
poop, or how much your SO pees, or how often either of you go to the bathroom.
Instead, play around with the simulation below to see what policy you should
choose.</p>

<table>
  <tr>
    <th colspan=3><i>Who goes more?</i></th>
    <td></td>
    <th colspan=3><i>When the man goes, what does he do?</i></th>
  </tr>
  <tr>
    <td><td>Her</td><td><div style="margin: 10px; width: 200px" id="whoGoesMore"></div></td><td>Him</td>
    <td>&nbsp</td>
    <td>Poop</td><td><div style="margin: 10px; width: 200px" id="whatHeDoes"></div></td><td>Pee</td>
  </tr>
</table>

<script>
$(function() {
    $("#whoGoesMore").slider({
    min: 0.0,
    max: 1.0,
    step: 0.01,
    value: 0.5
    });
    $("#whatHeDoes").slider({
    min: 0.0,
    max: 1.0,
    step: 0.01,
    value: 0.75
    });

  var viz = drawChart();

  var updated = function() {
    var d = getData();

    var genders = d3.layout.stack()(["Man", "Woman"].map(function(gender) {
      return d.map(function(d) {
        return {x: d.Policy, y: d[gender]};
      });
    }));

    var gender = viz.selectAll("g.cause").data(genders);

    var rect = gender.selectAll("rect")
      .transition()
      .duration(500)
      .attr("height", function(d) { alert(y(d.y)); return y(d.y); })

    calculate();
  };
  $( "#whoGoesMore" ).on("slidechange", updated);
  $( "#whatHeDoes" ).on("slidechange", updated);
  calculate();
});
</script>


<script type="text/javascript">
var drawChart = function() {
  var w = 300,
      h = 300,
      p = [20, 50, 30, 20],
      x = d3.scale.ordinal().rangeRoundBands([0, w - p[1] - p[3]]),
      y = d3.scale.linear().range([0, h - p[0] - p[2]]),
      z = d3.scale.ordinal().range(["lightblue", "lightpink"]);
  
  var svg = d3.select("#chart").append("svg:svg")
      .attr("width", w)
      .attr("height", h)
      .append("svg:g")
      .attr("transform", "translate(" + p[3] + "," + (h - p[2]) + ")");
  
  var data = getData();
  
  // Transpose the data into layers by person.
  var genders = d3.layout.stack()(["Man", "Woman"].map(function(gender) {
    return data.map(function(d) {
      return {x: d.Policy, y: d[gender]};
    });
  }));

    // Compute the x-domain (by date) and y-domain (by top).
  x.domain(genders[0].map(function(d) { return d.x; }));
  y.domain([0, 2]);
  //y.domain([0, d3.max(genders[genders.length - 1], function(d) { return d.y0 + d.y; })]);
  
    // Add a group for each cause.
  var gender = svg.selectAll("g.cause")
      .data(genders)
    .enter().append("svg:g")
      .attr("class", "gender")
      .style("fill", function(d, i) { return z(i); })
      .style("stroke", function(d, i) { return d3.rgb(z(i)).darker(); });
  
    // Add a rect for each policy
  var rect = gender.selectAll("rect")
      .data(Object)
      .enter().append("svg:rect")
        .attr("x", function(d) { return x(d.x); })
        .attr("y", function(d) { return -y(d.y0) - y(d.y); })
        .attr("height", function(d) { return y(d.y); })
        .attr("width", x.rangeBand());
  
    // Add a label per date.
  var label = svg.selectAll("text")
    .data(x.domain())
    .enter().append("svg:text")
        .attr("x", function(d) { return x(d) + x.rangeBand() / 2; })
        .attr("y", 6)
        .attr("text-anchor", "middle")
        .attr("dy", ".71em")
        .text(function(d) { return d; });
  
    // Add y-axis rules.
    var rule = svg.selectAll("g.rule")
        .data(y.ticks(5))
      .enter().append("svg:g")
        .attr("class", "rule")
        .attr("transform", function(d) { return "translate(0," + -y(d) + ")"; });
  
    rule.append("svg:line")
        .attr("x2", w - p[1] - p[3])
        .style("stroke", function(d) { return d ? "#fff" : "#000"; })
        .style("stroke-opacity", function(d) { return d ? .7 : null; });
  
    rule.append("svg:text")
        .attr("x", w - p[1] - p[3] + 6)
        .attr("dy", ".35em")
        .text(d3.format(",2f"));
    return svg;
};
</script>

<style type="text/css">
svg {
  width: 300;
  height: 300;
  border: solid 1px #ccc;
  font: 10px sans-serif;
  shape-rendering: crispEdges;
}
</style>

<table>
  <tr>
    <td width="50%">
      <div id="chart"></div>
    </td>
    <td>
      <table>
        <tr>
          <td>Policy</td><td>\(C_{Him}\)</td><td>\(C_{Her}\)</td><td>\(C_{Joint}\)</td>
        </tr>
        <tr>
          <td>1</td><td id="cm1"></td><td id="cw1"></td><td id="cj1"></td>
        </tr>
        <tr>
          <td>1-Prime</td><td id="cm1p"></td><td id="cw1p"></td><td id="cj1p"></td>
        </tr>
        <tr>
          <td>2</td><td id="cm2"></td><td id="cw2"></td><td id="cj2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
